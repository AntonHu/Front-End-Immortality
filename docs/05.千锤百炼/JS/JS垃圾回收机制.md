# JS垃圾回收机制

JS采用分代式垃圾回收机制，内存分为新老生代空间

## 新生代空间

存放短期数据，采用**Scavenge GC算法（复制算法）**，有**From**和**To**两个空间。

新分配的对象放From空间，当From空间满时，进行GC处理，将存活对象复制到To空间，销毁失活对象，然后将To空间与From空间互换

## 老生代空间

存放长期活跃数据，有两个算法，**标记清除算法**和**标记压缩算法**。

### 如何进入老生代

1. 经历过新生代GC的对象会进入老生代空间
2. 在To空间内存占用超过25%的对象

### 标记清除法

标记：从根对象遍历，即全局对象或当前调用栈变量开始，遍历所有可触达对象，将其标记为活跃。

清除：遍历堆内存，清除回收所有未标记的对象（为优化回收造成的页面停顿，后续升级了增量标记和并发标记）

### 标记压缩法

也叫标记整理法，标记清除后形成碎片空间，当碎片过多会触发整理，将活跃对象往一端迁移聚集，然后清除回收空闲空间

## 优化内存使用

- 避免全局变量
- 及时释放引用，如设置null，清定时器事件监听
- 使用弱引用(WeakSet和WeakMap)存放临时数据